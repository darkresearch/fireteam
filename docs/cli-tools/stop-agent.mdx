---
title: "stop-agent"
description: "Gracefully shutdown running Fireteam projects"
---

## Synopsis

```bash
stop-agent
```

## Description

The `stop-agent` command gracefully shuts down the running Fireteam orchestrator and all associated agent processes. It sends a SIGTERM signal for clean shutdown, waits up to 30 seconds for graceful exit, and performs cleanup of PID files and orphaned processes.

## Basic Usage

```bash
stop-agent
```

**Expected output:**
```
Stopping Fireteam (PID: 12345)...
Agent system stopped
```

## What stop-agent Does

### 1. Validation
- Checks if orchestrator is running
- Reads PID from `/home/claude/fireteam/orchestrator.pid`
- Validates process exists

### 2. Graceful Shutdown
- Sends **SIGTERM** signal (signal 15)
- Orchestrator receives shutdown signal
- Current agent phase completes (if possible)
- State file saved
- Git commit finalized

### 3. Timeout Handling
- Waits up to **30 seconds** for graceful exit
- If still running after timeout, sends **SIGKILL** (signal 9)
- Forces immediate termination

### 4. Cleanup
- Terminates any orphaned Claude CLI processes
- Removes PID file
- Leaves state file intact (for later inspection)

## Shutdown Behavior

### Graceful Shutdown (Normal)

When you run `stop-agent`, the orchestrator:

1. **Receives SIGTERM signal**
2. **Completes current operation** (if in progress):
   - Planning phase: Saves partial plan
   - Execution phase: Allows current command to finish
   - Review phase: Completes review
3. **Updates state file** with current progress
4. **Commits changes** to git (if any)
5. **Exits cleanly**

<Info>
Graceful shutdown preserves all progress. You can inspect the state and git commits to understand what was accomplished.
</Info>

### Forced Shutdown (After 30s)

If the process doesn't exit within 30 seconds:

1. **SIGKILL sent** (force termination)
2. **Immediate process death**
3. **State might not be saved** (last cycle's state available)
4. **Current operation incomplete**

<Warning>
Forced shutdown can leave the project in an inconsistent state. Use only as last resort.
</Warning>

## When to Stop

### Stop Early If:

❌ **Agent is off-track**
```bash
# Check what it's doing
fireteam-status --logs

# If building wrong features, stop
stop-agent
```

❌ **Wasting cycles on blockers**
```bash
# If stuck for 3+ cycles on same issue
fireteam-status  # Shows Cycle: 8, Completion: 75% (unchanged)
stop-agent
```

❌ **Resource constraints**
```bash
# If system resources exhausted
fireteam-status --watch  # Shows high CPU/memory
stop-agent
```

### Let It Continue If:

✅ **Making steady progress**
```
Cycle 0: 85% → Cycle 1: 92% → Cycle 2: 95%
```

✅ **In validation mode**
```
Completion: 96% (validation check 2/3)
```

✅ **Near completion**
```
Cycle 4, Completion: 94% - likely 1-2 cycles to finish
```

## State Preservation

### What's Preserved on Stop

✅ Git commits up to last completed cycle
✅ State file with last known progress
✅ All project files
✅ Log files

### What's Lost on Stop

❌ Current in-progress cycle (not committed yet)
❌ Agent's in-memory state
❌ Partial plan/execution/review

### Inspecting After Stop

```bash
# Check final state
cat /home/claude/fireteam/state/current.json | python3 -m json.tool

# View git history
cd ~/your-project
git log --oneline

# See what was accomplished
git diff HEAD~3..HEAD  # Last 3 cycles
```

## Troubleshooting

### "Agent system is not running"

**Situation 1: Already stopped**
```bash
$ stop-agent
Agent system is not running (no PID file found)
```

**This is normal** - nothing to stop.

**Situation 2: Stale PID file**
```bash
$ stop-agent
Agent system is not running (stale PID file)
```

**Handled automatically** - stale PID file removed.

### Process Won't Stop (Hangs)

**Symptoms:**
- `stop-agent` waits 30 seconds
- Shows "Process did not stop gracefully, forcing..."
- Eventually completes

**Causes:**
- Agent stuck in long-running operation
- Network call hanging
- Infinite loop in agent code

**Manual intervention:**
```bash
# Find PID
cat /home/claude/fireteam/orchestrator.pid

# Force kill
kill -9 <PID>

# Or kill all related processes
pkill -9 -f "claude-agent-system"
pkill -9 -f "claude --dangerously-skip-permissions"

# Cleanup
rm -f /home/claude/fireteam/orchestrator.pid
```

### Multiple Stop Attempts

**Problem:** Running `stop-agent` multiple times

**Behavior:**
```bash
$ stop-agent
Stopping Fireteam (PID: 12345)...
Agent system stopped

$ stop-agent
Agent system is not running (no PID file found)
```

**This is safe** - subsequent stops are no-ops.

### State Corruption After Force Kill

**Problem:** Forced shutdown corrupted state file

**Symptoms:**
```bash
fireteam-status
Error loading state: Expecting property name enclosed in double quotes
```

**Solution:**
```bash
# Backup corrupted state
cp /home/claude/fireteam/state/current.json ~/state-backup.json

# Remove corrupted state
rm /home/claude/fireteam/state/current.json

# Start fresh (state will be recreated)
start-agent --project-dir ~/project --prompt "Continue previous work"
```

## Real-World Scenarios

### Scenario 1: Agent Drift Detected

```bash
# Check what agent is doing
$ fireteam-status --logs --lines 50
...
2025-10-17 15:30:00 - INFO - Creating npm deployment scripts
2025-10-17 15:31:00 - INFO - Setting up CI/CD pipeline
...

# Goal was just "Build a CLI", not deployment!
$ stop-agent
Stopping Fireteam (PID: 12345)...
Agent system stopped

# Review commits, potentially reset
$ cd ~/project
$ git log --oneline
abc1234 Cycle 3: Added deployment automation
def5678 Cycle 2: 95% complete
...

# Revert unwanted changes
$ git reset --hard def5678
```

### Scenario 2: Timeout Issues

```bash
# Agent stuck in execution phase for 30+ minutes
$ fireteam-status
Status: EXECUTING
Cycle: 5
Completion: 88%
Updated: 2025-10-17 14:00:00  # 40 minutes ago!

# Likely timed out, stop and investigate
$ stop-agent
Stopping Fireteam (PID: 12345)...
[waits 30 seconds]
Process did not stop gracefully, forcing...
Agent system stopped

# Check logs for timeout errors
$ fireteam-status --logs --lines 100 | grep -i timeout
```

### Scenario 3: Completion Satisfaction

```bash
# Check status
$ fireteam-status
Status: ✅ RUNNING
Cycle: 2
Completion: 92%

# Good enough for prototype, stop here
$ stop-agent
Stopping Fireteam (PID: 12345)...
Agent system stopped

# Test the project
$ cd ~/project
$ python main.py
# Works! Ship it.
```

## Stopping vs. Completion

### Manual Stop

**When:** You decide to stop
**How:** `stop-agent`
**Result:** Project at current completion level

**Use cases:**
- Early prototype sufficient
- Agent off-track
- Time constraints
- Resource limits

### Automatic Completion

**When:** Fireteam decides project is complete
**How:** 3 consecutive ≥95% reviews
**Result:** High-quality, validated project

**Indicators:**
```
Validation check 1/3: 96%
Validation check 2/3: 97%
Validation check 3/3: 98% ✅
PROJECT COMPLETED SUCCESSFULLY
```

**Behavior:**
- Orchestrator stops automatically
- Final commit created
- State marked as completed
- PID file removed

<Tip>
After automatic completion, `fireteam-status` shows:
```
Status: ⏹️ STOPPED
✅ COMPLETED: 2025-10-17 15:45:30
```
</Tip>

## Best Practices

### 1. Stop Before Starting New Projects

```bash
# Always stop before starting new work
stop-agent

# Verify stopped
fireteam-status

# Start new project
start-agent --project-dir ~/new-project --prompt "Goal"
```

### 2. Check Progress Before Stopping

```bash
# See what you'd be stopping
fireteam-status

# View recent work
fireteam-status --logs --lines 50

# Make informed decision
stop-agent  # or let it continue
```

### 3. Don't Interrupt Validation

If in validation mode, let it complete:

```bash
$ fireteam-status
Completion: 96%
Validation check 2/3

# Wait for third check (usually < 30 minutes)
# Then automatic completion
```

### 4. Save Important State

Before stopping, if you might want to continue:

```bash
# Backup state
cp /home/claude/fireteam/state/current.json ~/project-state-backup.json

# Then stop
stop-agent
```

## Advanced Usage

### Stopping from Scripts

```bash
#!/bin/bash
# auto-stop-on-error.sh

# Monitor logs for errors
fireteam-status --logs --follow | while read line; do
    if echo "$line" | grep -qi "critical error"; then
        echo "Critical error detected, stopping..."
        stop-agent
        exit 1
    fi
done
```

### Timed Auto-Stop

```bash
#!/bin/bash
# stop-after-2-hours.sh

sleep 7200  # 2 hours
if fireteam-status | grep -q "RUNNING"; then
    echo "Time limit reached, stopping agent"
    stop-agent
fi
```

### Conditional Stop

```bash
#!/bin/bash
# stop-if-stalled.sh

PREV_CYCLE=$(fireteam-status | grep "Cycle:" | awk '{print $2}')
sleep 1800  # 30 minutes

CURR_CYCLE=$(fireteam-status | grep "Cycle:" | awk '{print $2}')

if [ "$PREV_CYCLE" == "$CURR_CYCLE" ]; then
    echo "No progress in 30 minutes, stopping"
    stop-agent
fi
```

## Exit Codes

| Code | Meaning |
|------|---------|
| `0` | Successfully stopped or was not running |
| `1` | Error during shutdown (rare) |

## Alternatives to Stopping

### Option 1: Let It Complete

Most reliable approach:
```bash
# Just let validation finish
# Usually 1-3 more cycles
```

### Option 2: Monitor and Decide

```bash
# Watch for a while
fireteam-status --watch --interval 10

# Stop if necessary
# Ctrl+C to exit watch, then stop-agent
```

### Option 3: Review and Continue

```bash
# Stop to inspect
stop-agent

# Review commits
cd ~/project && git log --oneline

# Continue if needed (new run, fresh state)
start-agent --project-dir ~/project --prompt "Add feature X"
```

## Next Steps

<CardGroup cols={2}>

<Card title="Start Projects" icon="play" href="/cli-tools/start-agent">
  Launch new Fireteam projects
</Card>

<Card title="Monitor Status" icon="chart-line" href="/cli-tools/fireteam-status">
  Check progress and view logs
</Card>

<Card title="State Management" icon="database" href="/advanced/state-management">
  Understand state preservation
</Card>

<Card title="Troubleshooting" icon="wrench" href="/troubleshooting/troubleshooting">
  Resolve shutdown issues
</Card>

</CardGroup>
